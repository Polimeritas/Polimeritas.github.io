<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Game</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

    <link rel="shortcut icon" href="img/logo.png" type="image/x-icon"> 
    
    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.min.css" integrity="sha256-SCRy3fXoOamBaidKByHs9iJVLYJ65R/v6ycZNN4JhmE=" crossorigin="anonymous">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7925162344439931"
      crossorigin="anonymous"></script>

    <style>
      body {
        background-color: #f0f2f5;
      }
      #game-container {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.15);
        color: black;
        text-align: center;
        max-width: 700px;
        margin: 50px auto;
        position: relative;
        overflow: hidden;
        transition: background-color 0.5s ease-in-out;
      }
      h1 {
        color: #ff9800;
        margin-bottom: 25px;
        font-size: 2.5em;
      }
      #paragraph-display {
        font-size: 24px;
        margin-bottom: 30px;
        line-height: 1.6;
        text-align: justify;
        min-height: 100px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        transition: transform 0.5s ease-out;
      }
      #paragraph-display .word-span {
          margin-right: 8px;
          transition: color 0.2s ease-out, background-color 0.2s ease-out;
          padding: 2px 0px;
          border-radius: 4px;
          display: inline-block;
      }
      #paragraph-display .word-span span {
          display: inline-block;
          transition: color 0.08s ease-out, transform 0.05s ease-out;
      }
      #paragraph-display .word-active {
          background-color: rgba(255, 230, 150, 0.5);
          transform: scale(1.02);
      }
      #paragraph-display .word-completed {
          color: #4CAF50;
          font-weight: bold;
          opacity: 0.7;
          transition: opacity 0.5s ease-out;
      }
      input {
        padding: 12px 15px;
        font-size: 20px;
        border-radius: 8px;
        border: 3px solid #ff9800;
        width: 90%;
        margin-bottom: 20px;
        text-align: center;
        outline: none;
        transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      input.correct-border {
          border-color: #4CAF50;
          box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
      }
      input.incorrect-border {
          border-color: #f44336;
          box-shadow: 0 0 15px rgba(244, 67, 54, 0.5);
          animation: shakeInput 0.2s ease-in-out;
      }
      @keyframes shakeInput {
          0% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          50% { transform: translateX(5px); }
          75% { transform: translateX(-5px); }
          100% { transform: translateX(0); }
      }
      #score,
      #timer,
      #level {
        margin-top: 15px;
        font-size: 22px;
        font-weight: bold;
        color: #555;
        transition: color 0.3s ease-in-out, transform 0.1s ease-out;
      }
      #score.streak-active {
          color: #FFD700 !important;
          animation: pulseScore 1s infinite alternate;
      }
      @keyframes pulseScore {
          from { transform: scale(1); }
          to { transform: scale(1.08); }
      }
      button {
        background: #ff9800;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        cursor: pointer;
        transition: 0.3s ease-in-out;
        margin-top: 25px;
        box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
      }
      button:hover {
        background: #e68900;
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 152, 0, 0.4);
      }
      .char-correct {
          color: #4CAF50;
          font-weight: bold;
          transform: scale(1.05);
      }
      .char-incorrect {
          color: #f44336;
          animation: shakeChar 0.1s ease-in-out;
      }
      @keyframes shakeChar {
          0% { transform: translateX(0); }
          50% { transform: translateX(-1px); }
          100% { transform: translateX(1px); }
      }
      .word-completed-fade {
          animation: wordCompletedFade 0.4s forwards;
      }
      @keyframes wordCompletedFade {
          from { transform: scale(1); opacity: 1; color: #4CAF50; }
          to { transform: scale(1.1) translateY(-20px); opacity: 0; color: #4CAF50; }
      }
      .word-incorrect-shake {
          animation: wordIncorrectShake 0.5s forwards;
      }
      @keyframes wordIncorrectShake {
          0% { transform: translateX(0); color: #f44336; }
          25% { transform: translateX(-8px); }
          50% { transform: translateX(8px); }
          75% { transform: translateX(-8px); }
          100% { transform: translateX(0); color: #f44336; opacity: 0.5;}
      }
      .score-popup {
          position: absolute;
          font-size: 2.5em;
          font-weight: bold;
          color: #4CAF50;
          text-shadow: 2px 2px 5px rgba(0,0,0,0.4);
          opacity: 0;
          animation: scorePop 1s forwards;
          z-index: 10;
          pointer-events: none;
          white-space: nowrap;
      }
      @keyframes scorePop {
          0% { transform: translateY(0) scale(0.8); opacity: 0; }
          20% { opacity: 1; transform: translateY(-30px) scale(1); }
          100% { transform: translateY(-80px) scale(1.2); opacity: 0; }
      }
      #streak-notification {
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 4em;
        font-weight: bolder;
        color: #FFD700;
        text-shadow: 4px 4px 10px rgba(0,0,0,0.6);
        opacity: 0;
        transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        pointer-events: none;
        z-index: 1000;
        white-space: nowrap;
      }
      #streak-notification.show {
        opacity: 1;
        transform: translate(-50%, -55%) scale(1);
        animation: streakPop 0.6s ease-out;
      }
      @keyframes streakPop {
          0% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
          50% { transform: translate(-50%, -58%) scale(1.2); opacity: 1; }
          100% { transform: translate(-50%, -55%) scale(1); opacity: 1; }
      }
      #game-container.fever-mode {
          background: linear-gradient(45deg, #ff9800, #ffeb3b);
          box-shadow: 0px 0px 50px rgba(255, 215, 0, 0.7);
          animation: feverBgPulse 2s infinite alternate;
      }
      @keyframes feverBgPulse {
          from { box-shadow: 0px 0px 50px rgba(255, 215, 0, 0.7); }
          to { box-shadow: 0px 0px 70px rgba(255, 215, 0, 0.9); }
      }
      #paragraph-display.fever-mode-glow .word-span {
          text-shadow: 0 0 8px #fff, 0 0 15px #ffeb3b;
          color: #333;
      }
      #paragraph-display.fever-mode-glow .word-span.word-active {
          background-color: rgba(255, 255, 255, 0.3);
      }
      #fever-particles {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          overflow: hidden;
          z-index: 5;
      }
      .particle {
          position: absolute;
          background-color: #ffeb3b;
          border-radius: 50%;
          opacity: 0;
          animation: particleAnim 3s infinite ease-out;
      }
      @keyframes particleAnim {
          0% { transform: translate(0, 0) scale(0); opacity: 0; }
          20% { opacity: 1; transform: scale(1); }
          100% { transform: translate(var(--x), var(--y)) scale(0.5); opacity: 0; }
      }
      #timer-bar-container {
        width: 90%;
        height: 12px;
        background-color: #ddd;
        border-radius: 6px;
        margin: 15px auto;
        overflow: hidden;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
      }
      #timer-bar {
        height: 100%;
        width: 100%;
        background-color: #ff9800;
        transition: width 0.9s linear, background-color 0.3s ease-in-out;
      }
      #timer-bar.critical {
          background-color: #f44336;
          animation: timerCriticalPulse 1s infinite alternate;
      }
      @keyframes timerCriticalPulse {
          from { background-color: #f44336; }
          to { background-color: #e65c4e; }
      }
      #timer.critical-text {
          color: #f44336;
          animation: textPulse 1s infinite alternate;
      }
      @keyframes textPulse {
          from { transform: scale(1); }
          to { transform: scale(1.05); }
      }
    </style>
</head>

<body>
    <!-- Header Start -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3 bg-dark d-none d-lg-block">
                <img src="img/logo.png" class="navbar-brand w-150 h-100 m-10 p-0 d-flex align-items-center justify-content-center" style="color: rgb(237, 245, 229); height: 100px; width: 250px;">
                </img>
            </div>
            <div class="col-lg-9">
                <div class="row bg-dark d-none d-lg-flex">
                    <div class="col-lg-7 text-left text-white">
                        <div class="h-100 d-inline-flex align-items-center border-right border-primary py-2 px-3">
                            <i class="fa fa-envelope text-primary mr-2"></i>
                            <small>polimeritasproject2018@gmail.com</small>
                        </div>
                        <div class="h-100 d-inline-flex align-items-center py-2 px-2">
                            <i class="fa fa-phone-alt text-primary mr-2"></i>
                            <small>+6285214991705</small>
                        </div>
                    </div>
                    <div class="col-lg-5 text-right">
                        <div class="d-inline-flex align-items-center pr-2">
                            <a class="text-primary p-2" href="https://www.facebook.com/polimeritas.official/">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a class="text-primary p-2" href="https://www.linkedin.com/in/polimeritas2018/?src=aff-ref&trk=aff-ir_progid%3D8005_partid%3D10078_sid%3D_adid%3D449670&clickid=1CrQFfzEMxyIR5MydK2QZyiRUkDyyC1J9WjJWc0&mcid=6851962469594763264&irgwc=1">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a class="text-primary p-2" href="https://www.instagram.com/polimeritas.official/">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a class="text-primary p-2" href="https://www.youtube.com/channel/UCHKnYU2ZlhezXRPI7enPRCw">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <nav class="navbar navbar-expand-lg bg-white navbar-light p-0">
                    <a href="" class="navbar-brand d-block d-lg-none">
                        <h1 class="m-0 display-4 text-primary">Polimeritas</h1>
                    </a>
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse" style="padding-bottom: 0px; ">
                        <div class="navbar-nav mr-auto py-0">
                            <a href="index.html" class="nav-item nav-link ">Home</a>
                            <a href="about.html" class="nav-item nav-link">About</a>
                            <a href="education.html" class="nav-item nav-link">Education</a>
                            <a href="project.html" class="nav-item nav-link">Project</a>
                            <a href="partner-room.html" class="nav-item nav-link">Partner Room</a>
                            <div class="nav-item active dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Games</a>
                                <div class="dropdown-menu rounded-0 m-0">
                                    <a href="game.html" class="dropdown-item"> Sorting Challenge</a>
                                    <a href="quiz-game.html" class="dropdown-item">Quiz Challenge</a>
                                    <a href="typing-game.html" class="dropdown-item active">Typing Challenge</a>
                                </div>
                            </div>
                        </div>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLScniewZAxktM10GeyZx8NLSMaV9RKPjgfWF6ph5ZivHP0kjpQ/viewform" class="btn btn-primary mr-3 d-none d-lg-block">Join Volunteer</a>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    <!-- Header End -->

    <!-- Page Header Start -->
    <div class="container-fluid bg-primary py-5 mb-5">
        <div class="container py-5">
            <div class="row align-items-center py-4">
                <div class="col-md-6 text-center text-md-left">
                    <h1 class="display-4 mb-4 mb-md-0 text-secondary text-uppercase">Game</h1>
                </div>
                <div class="col-md-6 text-center text-md-right">
                    <div class="d-inline-flex align-items-center">
                        <a class="btn btn-sm btn-outline-dark" href="index.html">Home</a>
                        <i class="fas fa-angle-double-right text-dark mx-2"></i>
                        <a class="btn btn-sm btn-outline-dark disabled" href="">Typing Challenge</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Page Header End -->

<!-- main content of the game -->
<div id="game-container">
  <h1>Permainan Mengetik Polimer</h1>
  <div id="paragraph-display"></div>
  <input type="text" id="input" placeholder="Ketik di sini..." autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <p id="score">Skor: 0</p>
  <p id="timer">Waktu Tersisa: 120</p>
  <div id="timer-bar-container">
    <div id="timer-bar"></div>
  </div>
  <p id="level">Tahap: 1</p>
  <div id="streak-notification"></div>
  <div id="fever-particles"></div>
  <button onclick="handleGameStart()">Mulai </button>
</div>
<!-- end of the game content -->

    <!-- Footer Start -->
   <div class="container-fluid bg-dark text-white mt-5 py-5 px-sm-3 px-md-5">
    <div class="row pt-5">
        <div class="col-lg-6 col-md-6 mb-5">
            <a href="index.html" class="navbar-brand">
                <h1 class="m-0 mt-n3 display-4 text-primary" style="font-size: xx-large !important;">Polimeritas</h1>
            </a>
            <p style="text-align: justify;">Komunitas yang bergerak di bidang ilmu pengetahuan, sains dan teknologi yang berkaitan dengan polimer. Polimeritas bekerjasama memajukan masyarakat yang ahli, produktif, dan inovatif menyongsong Indonesia yang lebih baik di bidang polimer. </p>
            <h5 class="font-weight-semi-bold text-white mb-2">Opening Hours:</h5>
            <p class="mb-1">Mon – Sat, 8AM – 5PM</p>
            <p class="mb-0">Sunday: Closed</p>
        </div>
        <div class="col-lg-6 col-md-6 mb-5">
            <h4 class="font-weight-semi-bold text-primary mb-4">Get In Touch</h4>
            <p><i class="fa fa-map-marker-alt text-primary mr-2"></i>Pangkalpinang, Bangka Belitung, Indonesia</p>
            <p><i class="fa fa-phone-alt text-primary mr-2"></i>+6285214991705</p>
            <p><i class="fa fa-envelope text-primary mr-2"></i>polimeritasproject2018@gmail.com</p>
            <div class="d-flex justify-content-start mt-4">
                <a class="btn btn-light btn-social mr-2" href="https://www.facebook.com/polimeritas.official/"><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-light btn-social mr-2" href="https://www.linkedin.com/in/polimeritas2018/?src=aff-ref&trk=aff-ir_progid%3D8005_partid%3D10078_sid%3D_adid%3D449670&clickid=1CrQFfzEMxyIR5MydK2QZyiRUkDyyC1J9WjJWc0&mcid=6851962469594763264&irgwc=1"><i class="fab fa-linkedin-in"></i></a>
                <a class="btn btn-light btn-social" href="https://www.instagram.com/polimeritas.official/"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid bg-dark text-white border-top py-4 px-sm-3 px-md-5" style="border-color: #3E3E4E !important;">
    <div class="row">
        <div class="col-lg-9 text-center text-md-right mb-3 mb-md-0">
            <p class="m-0 text-white" >© <a href="#">Polimeritas</a>. All Rights Reserved. Designed by <a href="#">Technology's team</a>
            </p>
        </div>
    </div>
</div>
<!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary px-3 back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.js"></script>
    <script src="lib/isotope/isotope.pkgd.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.all.min.js" integrity="sha256-lCHT/LfuZjRp+PdpWns/vKrnSn367D/g1E6Ju18wiH0=" crossorigin="anonymous"></script>
    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>
    <!-- JavaScript game utama ada di sini -->
    <script>
        // Daftar kalimat lengkap terkait polimer dan Polimeritas
        const allSentences = [
            "Polimeritas memajukan inovasi di bidang teknologi polimer.",
            "Polimer adalah bahan kimia dengan rantai molekul panjang.",
            "Kami mengembangkan solusi berkelanjutan melalui penelitian polimer.",
            "Monomer adalah unit dasar pembentuk rantai polimer.",
            "Plastik termoplastik dapat dilelehkan dan dibentuk ulang.",
            "Polimerisasi adalah proses penggabungan monomer menjadi polimer.",
            "Karet sintetis digunakan dalam berbagai aplikasi industri.",
            "Biopolimer seperti selulosa ramah terhadap lingkungan.",
            "Polimeritas mendukung penelitian untuk masa depan yang lebih baik.",
            "Polipropilen adalah polimer yang kuat dan tahan panas.",
            "Teknologi polimer membantu menciptakan bahan yang inovatif.",
            "Komunitas Polimeritas berfokus pada sains dan teknologi.",
            "Polimer memiliki sifat unik karena struktur molekulnya.",
            "Penelitian polimer membuka peluang baru di bidang medis.",
            "Polimeritas mengedukasi masyarakat tentang pentingnya polimer."
        ];

        let score = 0;
        let totalTime = 120; // Waktu total game dalam detik
        let timeLeft = totalTime; // Waktu tersisa
        let level = 1;
        let scoreMultiplier = 1; // Untuk bonus streak
        let streakCount = 0; // Menghitung streak
        let gameInterval; // Interval utama game timer
        let feverModeActive = false; // Status Fever Mode
        let gameInitialized = false; // Flag untuk memastikan inisialisasi awal

        let currentParagraphWords = []; // Array kata-kata dalam kalimat saat ini
        let currentWordIndex = 0; // Indeks kata yang sedang diketik dalam kalimat

        // Elemen Audio (catatan: file audio tidak ada dalam repo, pastikan ada atau hapus referensi)
        const correctCharSound = new Audio('audio/correct_char.mp3');
        const wrongCharSound = new Audio('audio/wrong_char.mp3');
        const wordCompleteSound = new Audio('audio/word_complete.mp3');
        const streakSound = new Audio('audio/streak.mp3');
        const levelUpSound = new Audio('audio/levelup.mp3');
        const gameOverSound = new Audio('audio/gameover.mp3');
        const feverModeStartSound = new Audio('audio/fever_start.mp3');
        const feverModeEndSound = new Audio('audio/fever_end.mp3');

        // Dapatkan elemen-elemen DOM
        const gameContainer = document.getElementById('game-container');
        const paragraphDisplay = document.getElementById('paragraph-display');
        const inputField = document.getElementById('input');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const levelDisplay = document.getElementById('level');
        const timerProgressBar = document.getElementById('timer-bar');
        const streakNotification = document.getElementById('streak-notification');
        const feverParticlesContainer = document.getElementById('fever-particles');
        const startButton = document.querySelector('button');

        // --- Fungsi Game Core ---

        // Fungsi untuk mendapatkan kalimat baru
        function getNewParagraph() {
            // Pilih satu kalimat acak dari allSentences
            const selectedSentence = allSentences[Math.floor(Math.random() * allSentences.length)];
            // Pecah kalimat menjadi array kata
            return selectedSentence.split(' ');
        }

        // Fungsi untuk menampilkan kalimat di layar
        function displayParagraph() {
            currentParagraphWords = getNewParagraph();
            currentWordIndex = 0;

            // Buat elemen span untuk setiap kata dan setiap karakter
            paragraphDisplay.innerHTML = currentParagraphWords.map((word, wordIdx) => {
                const chars = word.split('').map(char => `<span>${char}</span>`).join('');
                return `<span class="word-span" id="word-${wordIdx}">${chars}</span>`;
            }).join(' ');

            highlightCurrentWord();
            inputField.value = '';
            inputField.classList.remove('correct-border', 'incorrect-border');
            inputField.focus();

            paragraphDisplay.style.transform = 'translateY(0)';
            paragraphDisplay.style.opacity = '1';
        }

        // Fungsi untuk menyorot kata yang sedang aktif diketik
        function highlightCurrentWord() {
            paragraphDisplay.querySelectorAll('.word-span').forEach(span => {
                span.classList.remove('word-active');
            });

            const activeWordSpan = document.getElementById(`word-${currentWordIndex}`);
            if (activeWordSpan) {
                activeWordSpan.classList.add('word-active');
                activeWordSpan.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Fungsi untuk memulai atau merestart game
        function handleGameStart() {
            if (!gameInitialized) {
                startGameLogic();
                gameInitialized = true;
                startButton.textContent = "Mulai Ulang";
            } else {
                Swal.fire({
                    title: "Mulai Ulang Game?",
                    text: "Semua progres akan hilang!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#ff9800",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Ya, Mulai Ulang!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        startGameLogic();
                        Swal.fire(
                            "Dimulai!",
                            "Game telah di-restart. Semangat!",
                            "success"
                        );
                    }
                });
            }
        }

        function startGameLogic() {
            score = 0;
            timeLeft = totalTime;
            level = 1;
            streakCount = 0;
            scoreMultiplier = 1;
            feverModeActive = false;

            scoreDisplay.textContent = `Skor: ${score}`;
            timerDisplay.textContent = `Waktu Tersisa: ${timeLeft}`;
            levelDisplay.textContent = `Tahap: ${level}`;
            timerProgressBar.style.width = '100%';
            timerProgressBar.classList.remove('critical');
            timerDisplay.classList.remove('critical-text');
            hideStreakNotification();
            disableFeverMode();

            inputField.disabled = false;
            displayParagraph();
            
            clearInterval(gameInterval);

            gameInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `Waktu Tersisa: ${timeLeft}`;
                
                const progressPercentage = (timeLeft / totalTime) * 100;
                timerProgressBar.style.width = `${progressPercentage}%`;

                if (timeLeft <= 30 && !timerProgressBar.classList.contains('critical')) {
                    timerProgressBar.classList.add('critical');
                    timerDisplay.classList.add('critical-text');
                } else if (timeLeft > 30 && timerProgressBar.classList.contains('critical')) {
                    timerProgressBar.classList.remove('critical');
                    timerDisplay.classList.remove('critical-text');
                }

                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            clearInterval(gameInterval);
            inputField.disabled = true;
            gameOverSound.play();
            disableFeverMode();

            Swal.fire({
                title: "Waktu Habis!",
                html: `Skor Akhirmu: <b>${score}</b><br>Kamu mencapai Tahap: <b>${level}</b>`,
                icon: "info",
                confirmButtonColor: "#ff9800",
                confirmButtonText: "Main Lagi!"
            }).then(() => {
                // Tidak langsung memulai game baru
            });
        }

        // --- Event Listener untuk Input ---

        inputField.addEventListener('input', (e) => {
            if (inputField.disabled) return;

            const typedValue = inputField.value;
            const targetWord = currentParagraphWords[currentWordIndex];
            
            if (!targetWord) return;

            const currentWordSpan = document.getElementById(`word-${currentWordIndex}`);
            const charSpans = currentWordSpan ? currentWordSpan.querySelectorAll('span') : [];

            let isCurrentCharCorrect = true;

            for (let i = 0; i < targetWord.length; i++) {
                if (charSpans[i]) {
                    if (i < typedValue.length) {
                        if (typedValue[i] === targetWord[i]) {
                            charSpans[i].classList.add('char-correct');
                            charSpans[i].classList.remove('char-incorrect');
                            if (e.data && i === typedValue.length - 1) {
                                correctCharSound.currentTime = 0;
                                correctCharSound.play();
                            }
                        } else {
                            charSpans[i].classList.add('char-incorrect');
                            charSpans[i].classList.remove('char-correct');
                            isCurrentCharCorrect = false;
                            wrongCharSound.currentTime = 0;
                            wrongCharSound.play();
                            inputField.classList.add('incorrect-border');
                            setTimeout(() => inputField.classList.remove('incorrect-border'), 100);
                            break;
                        }
                    } else {
                        charSpans[i].classList.remove('char-correct', 'char-incorrect');
                    }
                }
            }

            if (isCurrentCharCorrect && typedValue.length > 0) {
                inputField.classList.add('correct-border');
                inputField.classList.remove('incorrect-border');
            } else if (typedValue.length === 0) {
                inputField.classList.remove('correct-border', 'incorrect-border');
            }

            if (e.data === ' ' || typedValue === targetWord) {
                e.preventDefault();
                
                if (typedValue.trim() === targetWord) {
                    wordCompleteSound.play();

                    score += 10 * scoreMultiplier;
                    scoreDisplay.textContent = `Skor: ${score}`;
                    showScorePopup(10 * scoreMultiplier);

                    if (currentWordSpan) {
                        currentWordSpan.classList.add('word-completed-fade');
                        currentWordSpan.classList.add('word-completed');
                    }
                    
                    streakCount++;
                    showStreakNotification();

                    currentWordIndex++;
                    if (currentWordIndex < currentParagraphWords.length) {
                        highlightCurrentWord();
                        inputField.value = '';
                        inputField.classList.remove('correct-border', 'incorrect-border');
                    } else {
                        paragraphDisplay.style.transform = 'translateY(-100%)';
                        paragraphDisplay.style.opacity = '0';
                        setTimeout(() => {
                            displayParagraph();
                            paragraphDisplay.style.transform = 'translateY(0)';
                            paragraphDisplay.style.opacity = '1';
                            checkLevelUp();
                        }, 500);
                        inputField.value = '';
                        inputField.classList.remove('correct-border', 'incorrect-border');
                    }

                } else {
                    streakCount = 0;
                    hideStreakNotification();
                    showPenaltyFeedback("Salah! -5s");
                    wrongCharSound.play();
                    inputField.classList.add('incorrect-border');
                    setTimeout(() => inputField.classList.remove('incorrect-border'), 100);

                    timeLeft = Math.max(0, timeLeft - 5);
                    timerDisplay.textContent = `Waktu Tersisa: ${timeLeft}`;
                    
                    if (currentWordSpan) {
                        currentWordSpan.classList.add('word-incorrect-shake');
                        setTimeout(() => {
                            currentWordSpan.classList.remove('word-incorrect-shake');
                            currentWordSpan.querySelectorAll('span').forEach(s => s.classList.remove('char-correct', 'char-incorrect'));
                        }, 500);
                    }
                    inputField.value = '';
                }
            }
        });

        // --- Implementasi Sistem "Streak" dan Feedback Visual ---

        function showStreakNotification() {
            if (streakCount >= 3) {
                let message = '';
                let streakBonus = 0;
                if (streakCount === 3) { message = "KOMBO!"; streakBonus = 10; }
                else if (streakCount === 5) { message = "HEBAT!"; streakBonus = 20; }
                else if (streakCount === 10) { message = "SUPER STREAK!"; streakBonus = 50; }
                else if (streakCount >= 15 && streakCount % 5 === 0) { message = `GILA! x${streakCount}`; streakBonus = 100; }
                else { message = `Streak! x${streakCount}`; }

                streakNotification.textContent = message;
                streakNotification.classList.add('show');
                streakSound.currentTime = 0;
                streakSound.play();

                scoreMultiplier = 1 + (streakCount * 0.1);
                scoreDisplay.classList.add('streak-active');

                if (streakBonus > 0) {
                    score += streakBonus;
                    scoreDisplay.textContent = `Skor: ${score}`;
                    showScorePopup(streakBonus, true);
                }

                if (streakCount >= 10 && !feverModeActive) {
                    activateFeverMode();
                }

                clearTimeout(streakNotification.timeout);
                streakNotification.timeout = setTimeout(() => {
                    hideStreakNotification();
                }, 1500);
            } else {
                hideStreakNotification();
                if (feverModeActive && streakCount < 10) {
                    disableFeverMode();
                }
            }
        }

        function hideStreakNotification() {
            streakNotification.classList.remove('show');
            scoreDisplay.classList.remove('streak-active');
            scoreMultiplier = 1;
        }

        function showPenaltyFeedback(message) {
            const penaltyDiv = document.createElement('div');
            penaltyDiv.textContent = message;
            penaltyDiv.classList.add('score-popup');
            penaltyDiv.style.color = '#f44336';
            
            const inputRect = inputField.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            penaltyDiv.style.left = `${inputRect.left - containerRect.left + inputRect.width / 2}px`;
            penaltyDiv.style.top = `${inputRect.top - containerRect.top - 20}px`;
            gameContainer.appendChild(penaltyDiv);

            setTimeout(() => {
                penaltyDiv.remove();
            }, 800);
        }

        function showScorePopup(points, isBonus = false) {
            const scorePopup = document.createElement('div');
            scorePopup.textContent = `+${points}`;
            scorePopup.classList.add('score-popup');
            if (isBonus) {
                scorePopup.style.fontSize = '3.5em';
                scorePopup.style.color = '#FFD700';
                scorePopup.style.textShadow = '3px 3px 7px rgba(0,0,0,0.6)';
                scorePopup.style.animation = 'scorePop 1.2s forwards';
            }

            const activeWordSpan = document.getElementById(`word-${currentWordIndex - 1}`);
            if (activeWordSpan) {
                const wordRect = activeWordSpan.getBoundingClientRect();
                const containerRect = gameContainer.getBoundingClientRect();
                scorePopup.style.left = `${wordRect.left - containerRect.left + wordRect.width / 2}px`;
                scorePopup.style.top = `${wordRect.top - containerRect.top - 30}px`;
            } else {
                scorePopup.style.left = '50%';
                scorePopup.style.top = '50%';
                scorePopup.style.transform = 'translate(-50%, -50%)';
            }
            
            gameContainer.appendChild(scorePopup);

            setTimeout(() => {
                scorePopup.remove();
            }, isBonus ? 1200 : 800);
        }

        // --- Implementasi Fever Mode ---
        function activateFeverMode() {
            feverModeActive = true;
            feverModeStartSound.play();
            gameContainer.classList.add('fever-mode');
            paragraphDisplay.classList.add('fever-mode-glow');
            scoreMultiplier = 2;
            createFeverParticles();
            Swal.fire({
                title: "FEVER MODE AKTIF!",
                text: "Poinmu berlipat ganda! Ketik secepat mungkin!",
                icon: "warning",
                confirmButtonColor: "#ff9800",
                timer: 2000,
                timerProgressBar: true
            });
        }

        function disableFeverMode() {
            feverModeActive = false;
            feverModeEndSound.play();
            gameContainer.classList.remove('fever-mode');
            paragraphDisplay.classList.remove('fever-mode-glow');
            scoreMultiplier = 1;
            feverParticlesContainer.innerHTML = '';
        }

        function createFeverParticles() {
            feverParticlesContainer.innerHTML = '';
            const particleCount = 30;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const size = Math.random() * 8 + 4;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.setProperty('--x', `${(Math.random() - 0.5) * 200}px`);
                particle.style.setProperty('--y', `${(Math.random() - 0.5) * 200}px`);
                particle.style.animationDelay = `${Math.random() * 2}s`;
                feverParticlesContainer.appendChild(particle);
            }
        }

        // --- Logic Kenaikan Level ---
        function checkLevelUp() {
            const scoreNeededForLevel = level * 200 + (level * level * 50);
            if (score >= scoreNeededForLevel) {
                level++;
                levelDisplay.textContent = `Tahap: ${level}`;
                timeLeft += 20;
                timerDisplay.textContent = `Waktu Tersisa: ${timeLeft}`;
                totalTime += 20;
                
                levelUpSound.play();

                Swal.fire({
                    title: `LEVEL UP! Tahap ${level}!`,
                    text: "Waktu tambahan dan tantangan baru menanti!",
                    icon: "success",
                    confirmButtonColor: "#ff9800",
                    timer: 1500,
                    timerProgressBar: true
                });

                gameContainer.classList.add('level-up');
                setTimeout(() => {
                    gameContainer.classList.remove('level-up');
                }, 1500);
            }
        }

        // --- Inisialisasi Game ---
        document.addEventListener('DOMContentLoaded', () => {
            correctCharSound.load();
            wrongCharSound.load();
            wordCompleteSound.load();
            streakSound.load();
            levelUpSound.load();
            gameOverSound.load();
            feverModeStartSound.load();
            feverModeEndSound.load();
            
            inputField.disabled = true;
            displayParagraph();
            if (!gameInitialized) {
                startButton.textContent = "Mulai Game";
            }
        });
    </script>
</body>
</html>